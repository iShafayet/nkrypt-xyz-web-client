FROM node:16 as clientbuild
WORKDIR /app

COPY package*.json ./
RUN npm install

ARG VITE_STOCK_PASSWORD_FOR_TESTING
ENV VITE_STOCK_PASSWORD_FOR_TESTING=$VITE_STOCK_PASSWORD_FOR_TESTING
ARG VITE_DEFAULT_SERVER_URL
ENV VITE_DEFAULT_SERVER_URL=$VITE_DEFAULT_SERVER_URL
ARG VITE_CLIENT_APPLICATION_NAME
ENV VITE_CLIENT_APPLICATION_NAME=$VITE_CLIENT_APPLICATION_NAME

COPY . .
RUN npm run build


FROM node:16 as base
WORKDIR /
COPY --from=clientbuild /app/dist/ /dist/
CMD [ "cp", "-R", "/dist", "/var/nkrypt-xyz-client-output" ]